<%= content_for :title, params[:query_name].presence || "pg_extras" %>

<% if unavailable_extensions.any? && !@result %>
  <% unavailable_extensions.each do |extension, queries| %>
    <span style='color: orange'>
      WARNING: Queries <%= queries.map { |q| "<b><u>#{q}</u></b>" }.join(", ").html_safe %> require extension: <b><%= extension %></b>
    </span>

    <h4>Rails</h4>
    <pre class="p-3 bg-gray-100">ActiveRecord::Base.connection.enable_extension "<%= extension %>"</pre>
    <h4>SQL</h4>
    <pre class="p-3 bg-gray-100">CREATE EXTENSION <%= extension %></pre>
  <% end %>
<% end %>

<% if @error %>
  <span class="text-red"><%= @error %></span>
<% else %>
  <% if @result&.any? %>
    <%= render "result",
      title: RubyPGExtras.description_for(query_name: @query_name),
      headers: @result[0].keys,
      rows: @result.values
    %>
  <% else %>
   <pre>No results</pre>
  <% end %>
<% end %>

<style>
@media print {
  form {
    display: none
  }
}
</style>